language: node_js
dist: trusty
node_js:
  - "8.9.1"
sudo: true
git:
  depth: 1

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install libusb-1.0-0 libusb-1.0-0-dev gcc-4.8 g++-4.8 build-essential -y
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.9.4
  - export PATH="$HOME/.yarn/bin:$PATH" CXX=g++-4.8
install:
  - yarn cache clean
  - yarn
  - yarn add --dev -W travis-github-lint-status-update
branches:
  only:
    - master
    - develop
    - release
    - ci
jobs:
  include:
    - stage: build docker image
      script:
        - yarn lint:errors; export LINT_RESULT=$?
        - echo $LINT_RESULT
        - ./node_modules/travis-github-lint-status-update/index.js
      after_script:
        - echo $LINT_RESULT
        - |
          if [ "$LINT_RESULT" == "0" ]; then
            if [ "$TRAVIS_BRANCH" == "ci" ]; then
              echo "Lint check is passed with the exit code: $LINT_RESULT. The app should be built";
            fi;
          elif [ "$TRAVIS_BRANCH" != "develop" ]; then
            echo "Lint check is failed with the exit code: $LINT_RESULT. Skipping image build and terminate!"
          fi;
        - kill -9 $(ps aux | grep '[t]estrpc' | awk '{print $2}')
