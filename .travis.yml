sudo: true
dist: trusty
jobs:
  include:
    - stage: build docker image
      script:
      - FULL_GCR_KEY='-----BEGIN PRIVATE KEY-----\n'$GCR_KEY'\n-----END PRIVATE KEY-----\n'
      - sed "s#PWD#"$FULL_GCR_KEY"#g" gcregistry.json
      #- sed -i -e 's/pwd/'$WALLET_PWD'/g' truffle-config.js
      #- sed -i -e 's/PWD/'$WALLET_PWD'/g' truffle-config.js
    #  - jq --arg key "$FULL_GCR_KEY" ."private_key" = $key gcregistry.json > tmp.json && mv tmp.json gcregistry.json
      - cat gcregistry.json
      - docker login -u _json_key -p "$(cat gcregistry.json)" https://gcr.io
      - rm gcregistry.json
      - docker build --quiet -t gcr.io/deep-wares-144610/chronomint:latest .
      - docker push gcr.io/deep-wares-144610/chronomint:latest
      
