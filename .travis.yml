sudo: true
dist: trusty
jobs:
  include:
    - stage: build docker image
      script:
      - jq --arg key "$GCR_KEY" '.private_key = "-----BEGIN PRIVATE KEY-----\\n"$key"\\n-----END PRIVATE KEY-----\\n"' gcregistry.json > tmp.json && mv tmp.json gcregistry.json
      - cat gcregistry.json
      - docker login -u _json_key -p "$(cat gcregistry.json)" https://gcr.io
      - rm gcregistry.json
      - docker build --quiet -t gcr.io/deep-wares-144610/chronomint:latest .
      - docker push gcr.io/deep-wares-144610/chronomint:latest
      
